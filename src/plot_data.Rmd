---
title: "Plot inventory data"
subtitle: "For: COST Action Alien CSI"
author:
- Lien Reyserhove
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
    number_sections: yes
    toc: yes
    toc_depth: 3
    toc_float: yes
#  pdf_document:
#    df_print: kable
#    number_sections: yes
#    toc: yes
#    toc_depth: 3
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

Load libraries:

```{r}
library(tidyverse)      # To do data science
library(magrittr)       # To use %<>% pipes
library(here)           # To find files
library(janitor)        # To clean input data
library(readxl)         # To read Excel files
library(digest)         # To generate hashes
```

# Read source data

Create a data frame `input_data` from the source data:
 
```{r}
input_data <- read_excel(path = here::here("data", "_Citizen.Science.projects_initiatives.IAS.in.Europe_11May20.xlsx")) 
```

Clean names:

```{r}
input_data %<>% clean_names() 
```

# Plot data

## Biosecurity regime

Summarize records

```{r}
biosecurity_regime <-
  input_data %>% 
  select(biosecurity_regime_added) %>% 
  group_by(biosecurity_regime_added) %>% 
  summarize(records = n())
```

Map biosecurity regime

```{r}
png(filename = here::here("data","processed","biosecurity.png"))
biosecurity <-
  ggplot(data = biosecurity_regime, 
       aes(x = biosecurity_regime_added, y = records)) +
  geom_bar(colour="black",fill="#FF6666",width=0.8, stat="identity") + 
  theme_classic() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 20, angle=45, hjust=1),
        axis.text.y = element_text(size = 20),
        axis.title.y = element_text(size = 20)) +
  ylab("Number of Projects") + xlab("") 
print(biosecurity)
```

## Invasive alien species of union concern

### General

Summarize records

```{r}
union_concern <-
  input_data %>% 
  select(invasive_alien_species_of_union_concern) %>% 
  group_by(invasive_alien_species_of_union_concern) %>% 
  summarize(records = n())
union_concern
```

Recode variables

```{r}
input_data %<>% 
  mutate(union_concern_recoded = recode(invasive_alien_species_of_union_concern,
    "Included = species of Union Concern included amongst other species"  = "Amongst\nother species",
    "Indirectly = general invasive alien species focus so may find some species of Union Concern" = "Amongst\nother species",
    "N/A = question not applicable" = "Unknown",
    "No = not at all" = "No",
    "Yes = this is the direct focus of the project" = "Direct focus"))
```

Summarize again

```{r}
union_concern <-
  input_data %>% 
    select(union_concern_recoded) %>% 
    group_by(union_concern_recoded) %>% 
    summarize(records = n())
union_concern
```
 
Plot species of union concern:

```{r}
png(filename = here::here("data","processed","union_concern.png"))
union_concern <-
  ggplot(data = union_concern, 
       aes(x = fct_relevel(union_concern_recoded, "Direct focus", "Amongst\nother species", "No", "Unknown"),
           y = records)) +
  geom_bar(colour="black",fill="#FF6666",width=0.8, stat="identity") + 
  theme_classic() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 20, angle=45, hjust=1),
        axis.text.y = element_text(size = 20),
        axis.title.y = element_text(size = 20)) +
  ylab("Number of Projects") + xlab("") 
print(union_concern)
```

### Per country

Separate country on comma (create new DF)

```{r}
country_long <-
  input_data %>% separate(country, 
                          into = paste("country", c(1:38), sep="_"),
                          sep = ",",
                          remove = FALSE)
```

From wide to long:

```{r}
country_long %<>% 
  gather(key = "key",
         value = "country_separate",
         paste("country", c(1:38), sep="_"),
         na.rm = TRUE)
```

Remove whitespace:

```{r}
country_long %<>% 
  mutate(country_separate = trimws(country_separate, "both"))
```

Show ias records per country

```{r}
country_long %<>% 
  select(country_separate, union_concern_recoded) %>% 
  group_by_all() %>% 
  summarize(n = n()) %>% 
  mutate(freq = n / sum(n))
country_long
```

Absoluut

```{r}
png(filename = here::here("data", "processed", "ias_country_abs.png"),
    width = 2000,
    height = 1000,
    units = "px")
ias_country_abs <-
  ggplot(data = country_long, 
         aes(x = country_separate, y = n, fill = union_concern_recoded)) +
    geom_bar(position = "stack", stat = "identity") + 
    theme_classic() +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.text.x = element_text(size = 20, angle=90, hjust=1),
          axis.text.y = element_text(size = 20),
          axis.title.y = element_text(size = 20),
          legend.title = element_text(size = 20),
          legend.text = element_text(size = 20)
          ) +
    ylab("Number of Projects") + xlab("") +
    scale_fill_discrete(
      name = "Category IAS concern",
      labels = c("amongst other species", "direct focus", "no", "unknown"))
print(ias_country_abs)
```

Relatief

```{r}
png(filename = here::here("data", "processed", "ias_country_rel.png"),
    width = 2000,
    height = 1000,
    units = "px")
ias_country_rel <-
  ggplot(data = country_long, 
         aes(x = country_separate, y = freq, fill = union_concern_recoded)) +
    geom_bar(position = "stack", stat = "identity") + 
    theme_classic() +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.text.x = element_text(size = 20, angle=90, hjust=1),
          axis.text.y = element_text(size = 20),
          axis.title.y = element_text(size = 20),
          legend.title = element_text(size = 20),
          legend.text = element_text(size = 20)
          ) +
    ylab("Number of Projects") + xlab("") +
    scale_fill_discrete(
      name = "Category IAS concern",
      labels = c("amongst other species", "direct focus", "no", "unknown"))
print(ias_country_rel)
```

## Number of participants

Inspect data

```{r}
input_data %>% 
  select(number_of_participants) %>% 
  group_by_all() %>% 
  summarize(records = n()) %>% 
  arrange(records)
```

Recode data

```{r}
input_data %<>% 
  mutate(number_of_participants_new = na_if(number_of_participants, "Info not available"))
```

Define `number_of_participants_new` as an ordered factor

```{r}
input_data $ number_of_participants_new <- factor(input_data $ number_of_participants_new, ordered = TRUE)
```

Re-order `number_of_participants`

```{r}
input_data $ number_of_participants_new <- ordered (input_data $ number_of_participants_new, levels = c("1 - 50", "51 - 100", 
"101 - 500", "501 - 1000", "1001 - 2000", "2001 - 5000", "5001 - 10000", "> 10001"))
```

Verify order

```{r}
levels(input_data$number_of_participants_new)
```

Summarize for graph

```{r}
number_of_participants <-
  input_data %>% 
    select(number_of_participants_new) %>% 
    group_by(number_of_participants_new) %>% 
    summarize(records = n())
```
 
Plot species of union concern:

```{r}
png(filename = here::here("data", "processed", "participants.png"))
participants <-
  ggplot(data = number_of_participants, 
       aes(x = number_of_participants_new,
           y = records)) +
  geom_bar(colour="black",fill="#FF6666",width=0.8, stat="identity") + 
  theme_classic() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 20, angle=45, hjust=1),
        axis.text.y = element_text(size = 20),
        axis.title.y = element_text(size = 20)) +
  ylab("Number of Projects") + xlab("") 
print(participants)
```

## Number of invasive alien species records

Inspect data

```{r}
input_data %>% 
  select(number_of_alien_or_invasive_alien_species_records) %>% 
  group_by(number_of_alien_or_invasive_alien_species_records) %>% 
  summarize(records = n()) %>% 
  arrange(records)
```

Recode:
```{r}
input_data %<>% 
  mutate(no_ias_records = na_if(number_of_alien_or_invasive_alien_species_records, "Info not available"))
```

```{r}
input_data %<>% 
  mutate(no_ias_records = recode(no_ias_records, 
    "1 - 50" = "< 100",
    "51 - 100" = "< 100",
    "51-100" = "< 100",
    "101 - 500" = "100 < x > 1000",
    "501 - 1000" = "100 < x > 1000",
     "1001 - 2000" = "1000 < x > 10.000",
     "2001 - 5000" = "1000 < x > 10.000",
     "5001 - 10000" = "1000 < x > 10.000",
     "50001 - 100000" = "> 10.000",
     "500001 - 1000000" = "> 10.000",
     "10001 - 50000" = "> 10.000",
     "100001 - 500000" = "> 10.000",
     "> 1000001" = "> 10.000"
    ))
```

Define `no_ias_records` as an ordered factor

```{r}
input_data $ no_ias_records <- factor(input_data $ no_ias_records, ordered = TRUE)
```

Re-order `no_ias_records`:

```{r}
input_data $ no_ias_records <- 
  ordered (input_data $ no_ias_records, levels = c("< 100" , "100 < x > 1000", 
"1000 < x > 10.000", "> 10.000"))
```

Verify order:

```{r}
levels(input_data$no_ias_records)
```

```{r}
no_ias_records <-
  input_data %>% 
    select(no_ias_records) %>% 
    group_by_all() %>% 
    summarize(records = n())
```

Plot species of union concern:

```{r}
png(filename = here::here("data", "processed", "no_ias_rec.png"))
no_ias_rec <-
  ggplot(data = no_ias_records, 
       aes(x = no_ias_records,
           y = records)) +
  geom_bar(colour="black",fill="#FF6666",width=0.8, stat="identity") + 
  theme_classic() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 20, angle=45, hjust=1),
        axis.text.y = element_text(size = 20),
        axis.title.y = element_text(size = 20)) +
  ylab("Number of Projects") + xlab("") 
print(no_ias_rec)
```

## Engagement method

Separate engagement method on comma:

```{r}
input_data %<>% separate(engagement_method_cleaned,
                        into = c("engagement_1", "engagement_2", 
                                 "engagement_3", "engagement_4",
                                 "engagement_5", "engagement_6",
                                 "engagement_7", "engagement_8"),
                        sep = ",")
```

From wide to long:

```{r}
input_data %<>% gather(
  key = "key",
  value = "value",
  "engagement_1", "engagement_2", "engagement_3", "engagement_4",
  "engagement_5", "engagement_6", "engagement_7", "engagement_8",
  na.rm = FALSE)
```

Remove whitespace:

```{r}
input_data %<>% mutate(value = trimws(value, "both"))
```

Capitalize:

```{r}
input_data %<>% mutate(value = str_to_title(value))
```

Summarize

```{r}
engagement <-
  input_data %>% 
  select(value) %>% 
  group_by(value) %>% 
  summarize(records = n())
engagement
```

Remove `e.g.` and `courses or workshops`:

```{r}
engagement %<>% filter(value != "E.g." | value != "Courses Or Workshops")
```

```{r}
png(filename = here::here("data", "processed", "engagement_method.png"))
engagement_method <-
  ggplot(data = engagement, 
       aes(x = value,
           y = records)) +
  geom_bar(colour="black",fill="#FF6666",width=0.8, stat="identity") + 
  theme_classic() +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
        axis.text.x = element_text(size = 20, angle=45, hjust=1),
        axis.text.y = element_text(size = 20),
        axis.title.y = element_text(size = 20)) +
  ylab("Number of Projects") + xlab("") 
print(engagement_method)
```
